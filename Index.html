<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Animal Disease Detector</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h1>Animal Disease Detector</h1>
  <p>Upload an image and select the animal species. Always consult a veterinarian.</p>

  <select id="speciesSelect">
    <option value="">Select species</option>
    <option value="cattle">Cattle</option>
    <option value="fish">Fish</option>
    <option value="poultry">Poultry</option>
  </select>

  <input type="file" id="imageInput" accept="image/*" />
  <img id="preview" src="" alt="" style="display:none;">
  <div class="error" id="error"></div>
  <div class="quota" id="quota"></div>
  <button id="analyzeBtn">Analyze Image</button>

  <div class="result" id="result" style="display:none;">
    <h3>Result</h3>
    <p id="label"></p>
    <p id="confidence"></p>
    <p id="details"></p>
  </div>
</div>

<script>
  const imageInput = document.getElementById('imageInput');
  const preview = document.getElementById('preview');
  const analyzeBtn = document.getElementById('analyzeBtn');
  const resultDiv = document.getElementById('result');
  const labelEl = document.getElementById('label');
  const confidenceEl = document.getElementById('confidence');
  const detailsEl = document.getElementById('details');
  const errorEl = document.getElementById('error');
  const quotaEl = document.getElementById('quota');
  const speciesSelect = document.getElementById('speciesSelect');

  let base64Image = '';

  const speciesModels = {
    cattle: "SrimathiE21ALR044/Cattle_Skin_Disease",
    fish: "Saon110/fish-shrimp-disease-classifier",
    poultry: "YourPoultryModelID" // replace with actual poultry model
  };

  imageInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if(file && file.type.startsWith('image/')){
      const reader = new FileReader();
      reader.onload = () => {
        base64Image = reader.result;
        preview.src = base64Image;
        preview.style.display = 'block';
        errorEl.textContent = '';
        quotaEl.textContent = '';
        resultDiv.style.display = 'none';
      };
      reader.readAsDataURL(file);
    } else {
      errorEl.textContent = 'Please select a valid image.';
    }
  });

  analyzeBtn.addEventListener('click', async () => {
    const species = speciesSelect.value;
    if(!species){
      errorEl.textContent = 'Please select an animal species.';
      return;
    }
    if(!base64Image){
      errorEl.textContent = 'Please upload an image first.';
      return;
    }

    analyzeBtn.disabled = true;
    errorEl.textContent = '';
    quotaEl.textContent = '';
    resultDiv.style.display = 'none';

    try {
      const modelID = speciesModels[species];
      if(!modelID){
        throw new Error('Model not configured for this species.');
      }

      const response = await fetch(`https://api-inference.huggingface.co/models/${modelID}`, {
        method: "POST",
        headers: {
          "Authorization": "Bearer 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",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ inputs: base64Image })
      });

      if(response.status === 429){
        quotaEl.textContent = "You have exceeded the free API quota. Please wait or upgrade your Hugging Face plan.";
        return;
      }

      if(!response.ok){
        throw new Error('Model API error');
      }

      const data = await response.json();
      if(Array.isArray(data) && data.length > 0){
        const res = data[0];
        labelEl.textContent = `Label: ${res.label || 'Unknown'}`;
        confidenceEl.textContent = `Confidence: ${res.score ? (res.score*100).toFixed(1)+'%' : 'N/A'}`;
        detailsEl.textContent = "AI model suggestion. Please confirm with a veterinarian.";
        resultDiv.style.display = 'block';
      } else {
        throw new Error('Unexpected model response');
      }

    } catch (err) {
      console.error(err);
      errorEl.textContent = 'Something went wrong while analyzing the image.';
    } finally {
      analyzeBtn.disabled = false;
    }
  });
</script>

</body>
</html>
